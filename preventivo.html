<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Preventivo Stampa 3D (-) Solo Calcolo - W OLE MILAN</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>Preventivo Stampa 3D (-) Solo Calcolo - W OLE INTER</h1>
</header>

<main>
  <section id="formPreventivo">
    <form id="preventivoForm" onsubmit="return false;">
      <label>Materiale e percentuale(%):</label>
      <div class="material-row">
        <select name="materiale" class="material-select">
          <option value="PLA">PLA (€20/kg)</option>
          <option value="ABS">ABS (€25/kg)</option>
          <option value="PETG">PETG (€22/kg)</option>
          <option value="TPU">TPU (€30/kg)</option>
        </select>
        <input type="number" min="1" max="100" value="100" class="material-quantita" /> <span>%</span>
      </div>

      <label for="ugello">Ugello:</label>
      <select id="ugello" name="ugello">
        <option value="0.2">0.2 mm</option>
        <option value="0.4" selected>0.4 mm</option>
        <option value="0.6">0.6 mm</option>
        <option value="0.8">0.8 mm</option>
      </select>

      <label for="velocita">Velocità:</label>
      <select id="velocita" name="velocita">
        <option value="0.5">50%</option>
        <option value="1" selected>100%</option>
        <option value="1.24">124%</option>
        <option value="1.6">160%</option>
      </select>

      <label for="quantita">Quantità (copie):</label>
      <input type="number" id="quantita" value="1" min="1" />

      <label for="projectNote">Nota:</label>
      <textarea id="projectNote" placeholder="Aggiungi una nota..."></textarea>

      <label>Caricamento progetto:</label>
      <p>Inserisci <strong>uno solo</strong> tra i due campi seguenti:</p>

      <label class="file-label" for="file3d">Scegli il file STL</label>
      <input type="file" id="file3d" accept=".stl" />
      <span class="file-name" id="fileName">Nessun file selezionato</span>

      <label for="projectLink">Oppure link progetto Makerworld:</label>
      <input type="text" id="projectLink" placeholder="Inserisci il link del progetto..." />

      <button id="btnCalcola">Calcola preventivo</button>

      <div id="risultato">Risultato preventivo: <span id="outputPrezzo">-</span></div>

      <label for="emailCliente">Email</label>
      <input type="email" id="emailCliente" placeholder="Inserire la propria email..." />

      <button id="sendEmailBtn" type="button">Invia dettagli via email</button>
      <div id="emailStatus" style="margin-top:10px; font-weight:bold;"></div>
    </form>
  </section>
</main>

<footer>
  <h1>Progetti Multimateriale e Multicolore</h1>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
  emailjs.init({ publicKey: "avx0UIyZCDX-4MASY" });

  // Mostra nome del file selezionato
  const fileInput = document.getElementById("file3d");
  const fileNameSpan = document.getElementById("fileName");
  fileInput.addEventListener("change", () => {
    if (fileInput.files.length > 0) {
        fileNameSpan.textContent = fileInput.files[0].name;
    } else {
        fileNameSpan.textContent = "Nessun file selezionato";
    }
  });

  // Invio email
  document.getElementById("sendEmailBtn").addEventListener("click", function () {
    const statusDiv = document.getElementById("emailStatus");
    statusDiv.innerText = "Email in corso...";

    const materiale = document.querySelector(".material-select").value;
    const ugello = document.getElementById("ugello").value;
    const velocita = document.getElementById("velocita").value;
    const quantita = document.getElementById("quantita").value;
    const projectNote = document.getElementById("projectNote").value;
    const projectLink = document.getElementById("projectLink").value;
    let emailCliente = document.getElementById("emailCliente").value;
    const nomeCliente = emailCliente ? emailCliente.split("@")[0] : "Cliente";

    if (!emailCliente) {
      emailCliente = "no_email@no_reply.com";
    }

    const file = fileInput.files[0] || null;

    const templateParams = {
      materiale,
      ugello,
      velocita,
      projectQuantity: quantita,
      projectNote,
      projectLink,
      nomeCliente,
      from_email: emailCliente,
      attachment: file
    };

    emailjs.send("service_ian3dlab", "emailPreventivo", templateParams)
      .then(() => {
        statusDiv.innerText = "Email inviata con successo!";
        document.getElementById("preventivoForm").reset();
        document.getElementById("outputPrezzo").innerText = "-";
        fileNameSpan.textContent = "Nessun file selezionato";
      })
      .catch((error) => {
        console.error("Errore nell'invio:", error);
        statusDiv.innerText = "Errore nell'invio: " + error.text;
      });
  });
</script>

</body>
</html>
